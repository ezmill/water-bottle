<html>
<head>
    <title>water-bottle</title>
    <style>
        body{
            margin: 0;
        }
    </style>
</head>
<body>
<script id="fs" type="x-fragment/x-shader">
precision mediump float;
uniform sampler2D texture; 
uniform float time; // seconds
varying vec2 vUv;
uniform vec2 resolution;

void main() {
    gl_FragColor = texture2D(texture, vUv);
}
</script>

<script id="fs-2" type="x-fragment/x-shader">
precision mediump float;
uniform sampler2D texture; 
uniform float time; // seconds
varying vec2 vUv;
uniform vec2 resolution;
uniform float mouseX;
uniform float mouseY;

float kernel[9];
float kernel2[9];
float kernel3[9];


vec2 offset[9];
vec2 offset2[9];
vec2 offset3[9];


uniform float step_w;
uniform float step_h;
uniform float tv_resolution;

#define TV_SCREEN_RESOLUTION_X 640.0

vec3 GetScreenPixelColor(vec2 ul)
{
    float x = mod(ul.x * tv_resolution / (1600.0/resolution.x) * 3.0,3.0);

    vec3 tex = texture2D(texture, vec2(ul.x,ul.y) ).xyz;
    
    return mix(mix(vec3(tex.r,0.0,0.0),vec3(0.0,tex.g,0.0),step(1.0,x)),
              vec3(0.0,0.0,tex.b),step(2.0,x));
}

void main(void)
{
    vec2 uv = vUv;
    vec3 new_col = vec3(0.0, 0.0, 0.0);
    vec3 old_col = vec3(0.0, 0.0, 0.0);

        float count=0.0;
        
        for (float i=-1.0;i<1.0;i+=0.33)
        {
            new_col += GetScreenPixelColor(vec2(uv.x+i/resolution.x,uv.y));
            count = count + 1.0;
        }

        new_col = 3.0*new_col/count;
        old_col = texture2D(texture, vec2(uv.x,uv.y) ).xyz;

    
        
    gl_FragColor = vec4(new_col,1.0);
}
</script>
<script id="sharpen" type="x-fragment/x-shader">
    varying vec2 vUv;
    uniform sampler2D texture;
    uniform vec2 resolution;
    uniform float step_w;
    uniform float step_h;
    float kernel[9];
    vec2 offset[9];
    float kernelWeight = 0.0;
    void main(){
        // float step_w = 1.0/resolution.x;
        // float step_h = 1.0/resolution.y;
        offset[0] = vec2(-step_w, -step_h); offset[1] = vec2(0.0, -step_h);
        offset[2] = vec2(step_w, -step_h); offset[3] = vec2(-step_w, 0.0);
        offset[4] = vec2(0.0, 0.0); offset[5] = vec2(step_w, 0.0);
        offset[6] = vec2(-step_w, step_h); offset[7] = vec2(0.0, step_h);
        offset[8] = vec2(step_w, step_h);

        kernel[0] = -2.0; kernel[1] = -1.0; kernel[2] = 1.0;
        kernel[3] = -1.0; kernel[4] = 1.0; kernel[5] = 1.0;
        kernel[6] = 1.0; kernel[7] = 1.0; kernel[8] = 2.0;
        // kernel[0] = -1.0; kernel[1] = 1.0; kernel[2] = -1.0;
        // kernel[3] = 1.0; kernel[4] = 8.0; kernel[5] = 1.0;
        // kernel[6] = -1.0; kernel[7] = 1.0; kernel[8] = -1.0;

        vec4 sum = texture2D(texture, vUv);
        for(int i = 0; i < 9; i++){
            sum += texture2D(texture, vUv + offset[i]) * kernel[i];
            kernelWeight += kernel[i];
        }
        if (kernelWeight <= 0.0) {
             kernelWeight = 1.0;
        }

        gl_FragColor =(vec4((sum/kernelWeight).rgb, 1.0));
        // gl_FragColor =sum;
    }
</script>
        <script id="fs-2-no" type="x-shader/x-fragment">
        uniform vec2 resolution;
        uniform vec2 mouse;
        uniform float time;
        uniform float pan;
        uniform sampler2D texture;
        varying vec2 vUv;

        void main( void ){
            //texture coordinates
            vec2 p = gl_FragCoord.xy / resolution.xy;
            
            // vec2 uv = p*0.15 + 0.25;
            // vec2 uv = vUv*0.15;
            //texture coordinates
            vec2 uv = vUv;
            
            //size of one pixel
            vec2 e = 1.0/resolution.xy;
            
            
            float am1 = 0.5 + 0.5*sin( time );
            // float am1 = 0.01;
            float am2 = cos( time );
            // float am2 = 5.0;
            float am3 = sin(time);

            for( int i=0; i<20; i++ ){
                //still not sure about this loop - this is where the magic happens
                //takes the dot of three textures with three vectors, 2 texture's coordinates being added by either width or height of 1 pixel, 3rd parameter of texture2D is bias of texture (sharpening i think)
                float h  = dot( texture2D(texture, uv,               -100.0).xyz, vec3(0.25, 0.25, 0.25) );
                float h1 = dot( texture2D(texture, uv+vec2(e.x,0.0), -100.0).xyz, vec3(0.25, 0.25, 0.25) );
                float h2 = dot( texture2D(texture, uv+vec2(0.0,e.y), -100.0).xyz, vec3(0.25, 0.25, 0.25) );
                // gradient - whatever that means
                // vec2 g = 0.01*vec2( (h1-h), (h2-h) )/e;
                vec2 g = 0.01*vec2( (h2-h), (h1-h) )/(e);
                // isoline  - whatever that means
                vec2 f = g.yx*vec2(-1.0,1.0);
                // vec2 f = g.yx*mouse;

                //mix with g with f by am1%
                g = mix( g, f, am1 );
                
                //multiply new g times 0.01 times am2 and add it/subtract it to/from the texture coords
                uv -= 0.001*g*am2;
            }
            //texture color isnt changing, only texture coordinates
            vec3 col = texture2D(texture, uv).xyz;
            
            // col *= 2.0;
                
            gl_FragColor = vec4(col, 1.0);
        }
        </script>
                <script id="repos" type="x-shader/x-fragment">
        precision mediump float;
        uniform sampler2D texture;
        varying vec2 vUv;

        // void main() {
        //  //this shader outputs the content of the feedback shader to the screen, texture represents feedback shader
        //   vec4 color = texture2D(texture, vUv);
        //   gl_FragColor = color;
        // }

        void main(){
            //vertex coords
            vec2 uv = vUv;
            //sample texture
            vec4 look = texture2D(texture,uv);
            //offset texture
            vec2 offs = vec2(look.y-look.x,look.w-look.z)*0.009;
            //relative coordinates
            vec2 coord = offs+uv;  
            //repositioned texture
            vec4 repos = texture2D(texture, coord);
            //final color
            gl_FragColor = repos;    
        } 

        </script>
<script id="vs" type="x-shader/x-vertex">
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    }
</script>
<script src="js/three.min.js"></script>
<script src="js/BinaryLoader.js"></script>
<script src="js/Detector.js"></script>
<script src="js/dat.gui.min.js"></script>
<script src="js/moire.js"></script>
</body>
</html>